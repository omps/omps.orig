
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Puppet Development With Vagrant - my tech notes and what's going on</title>
  <meta name="author" content="Om Prakash Singh">

  
  <meta name="description" content="I started working DevOps which initiated me to learn the about the configuration management and automation tools, Though it does have a learning &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.omps.in/blog/2016/04/24/puppet-development-environment">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="my tech notes and what's going on" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">my tech notes and what's going on</a></h1>
  
    <h2>personal blog about my rendezvous with technology and life.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
<ul class="subscribe">
  <li><a href="https://github.com/omps" rel="subscribe-github" title="@omps on GitHub" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 50,0 C 22.385714,0 0,22.385714 0,50 0,77.614286 22.385714,100 50,100 77.614286,100 100,77.614286 100,50 100,22.385714 77.614286,0 50,0 z m 29.692858,79.692858 c -3.859184,3.859182 -8.351022,6.887754 -13.35,9.00306 -1.27041,0.536736 -2.560204,1.009184 -3.867348,1.415306 v -7.493878 c 0,-3.938774 -1.35102,-6.835714 -4.053062,-8.690816 1.692858,-0.163264 3.24694,-0.390816 4.663266,-0.683672 1.416326,-0.292858 2.913266,-0.716328 4.491838,-1.27041 1.57857,-0.55408 2.994896,-1.213264 4.247958,-1.97755 1.253062,-0.765306 2.458164,-1.758164 3.613266,-2.978572 1.155102,-1.220408 2.12449,-2.604082 2.905102,-4.15 0.780612,-1.545918 1.4,-3.40204 1.855102,-5.566326 0.455102,-2.164286 0.683674,-4.54898 0.683674,-7.153062 0,-5.045918 -1.643878,-9.341836 -4.931634,-12.890816 C 77.44796,33.35 77.285714,29.10204 75.463266,24.512244 l -1.22143,-0.145918 c -0.845918,-0.09796 -2.368366,0.260204 -4.565306,1.07449 -2.196938,0.814286 -4.663264,2.14796 -7.396938,4.004082 -3.87449,-1.07449 -7.893878,-1.611224 -12.061224,-1.611224 -4.19898,0 -8.203062,0.536734 -12.012246,1.611224 -1.72449,-1.17245 -3.361224,-2.139796 -4.907142,-2.905102 C 31.753062,25.77449 30.516326,25.254082 29.587756,24.97653 28.660204,24.7 27.79796,24.528572 27,24.463266 c -0.79796,-0.0653 -1.310204,-0.08062 -1.537756,-0.04898 -0.22755,0.03164 -0.390816,0.0653 -0.487754,0.09796 -1.82347,4.62245 -1.985714,8.87143 -0.487756,12.743878 -3.287754,3.54796 -4.931632,7.844898 -4.931632,12.890816 0,2.604082 0.227552,4.988776 0.683674,7.153062 0.456122,2.164286 1.07449,4.020408 1.855102,5.566326 0.780612,1.545918 1.75,2.929592 2.905102,4.15 1.155102,1.220408 2.360204,2.213266 3.613264,2.978572 1.253062,0.766326 2.669388,1.42449 4.24796,1.97755 1.578572,0.554082 3.07551,0.976532 4.491836,1.27041 1.416328,0.292856 2.970408,0.521428 4.663266,0.683672 -2.669388,1.82347 -4.004082,4.720408 -4.004082,8.690816 v 7.639796 C 36.536734,89.818368 35.083674,89.3 33.656122,88.695918 c -4.99898,-2.115306 -9.490816,-5.143878 -13.35,-9.00306 -3.859184,-3.859184 -6.887754,-8.351022 -9.00306,-13.35 C 9.1163263,61.171428 8.0071428,55.67347 8.0071428,50 c 0,-5.67347 1.1091835,-11.171428 3.2969392,-16.342858 2.115306,-4.998978 5.143878,-9.490816 9.00306,-13.35 3.859184,-3.859182 8.351022,-6.887754 13.35,-9.00306 C 38.828572,9.1163266 44.32653,8.0071428 50,8.0071428 c 5.67347,0 11.171428,1.1091838 16.342858,3.2969392 5,2.115306 9.490816,5.143878 13.35,9.00306 3.859182,3.859184 6.887754,8.351022 9.00306,13.35 2.186736,5.17245 3.295918,10.67041 3.295918,16.342858 0,5.672448 -1.109182,11.171428 -3.296938,16.342858 -2.115306,4.998978 -5.143878,9.490816 -9.00204,13.35 l 0,0 z"></path></svg></a></li>
</ul>
  
  
  
<ul class="subscribe">
  <li><a href="https://twitter.com/ohgnis" rel="subscribe-twitter" title="@ohgnis on Twitter" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 512 512"><path class="social" d="M0.001,334.932c33.327,30.816,118.891,59.981,188.517-8.271c-12.52,1.955-22.972-0.416-30.913-8.269
  c-7.531-7.465-7.945-15.182-3.914-22.202c3.275-5.725,10.184-9.741,16.977-13.934c-12.323,2.285-22.829,1.095-32.218-3.706
  c-12.604-6.444-24.863-13.228-28.3-27.207c7.71-8.112,16.28-15.359,34.831-12.627c-17.45-5.83-33.087-13.429-44.41-24.815
  c-11.028-11.091-12.163-18.302-13.932-26.996c9.632-3.567,19.688-5.421,30.478-4.353c-24.397-12.476-34.757-29.63-40.487-48.325
  c-1.731-5.652-2.044-11.03-1.31-16.545c98.826,37.305,145.11,64.109,170.662,89.251c11.496-30.589,38.3-99.868,78.371-123.646
  c0.191,3.77-1.309,7.837-4.357,12.189c11.863-6.609,21.125-17.188,37.445-16.98c-1.879,7.723-7.279,13.904-17.85,17.854
  c10.662-4.084,21.463-7.545,32.65-9.578c10.375-1.881,10.229,6.304,4.355,10.444c-11.916,8.412-24.578,9.456-37.006,13.498
  c38.105,0.949,69.266,18.994,93.604,58.343c8.088,13.074,13.52,26.149,14.807,40.487c16.254,4.563,32.426,5.494,48.76,2.61
  c4.475-0.796,8.645-1.63,12.627-3.482c-6.354,9.529-13.686,17.356-23.947,20.899c-9.811,3.387-19.637,6.688-30.473,6.968
  c17.641,6.675,37.082,7.045,57.033,5.659c-24.402,23.486-43.08,22.922-61.824,22.642c-8.221,34.703-25.025,69.315-60.52,101.005
  c-46.559,41.569-96.678,61.397-148.457,65.742c-48.552,4.07-95.488,3.512-146.726-20.464
  C56.486,393.349,24.648,368.884,0.001,334.932L0.001,334.932z"/></svg></a></li>
</ul>
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="sitesearch" value="www.omps.in" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/index.html">Blog</a></li>
  <li><a href="/books">Books</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Puppet Development With Vagrant</h1>
      
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-24T16:40:46+05:30'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:40 pm</span></time>
        
        
      </p>
    
  </header>


<div class="entry-content"><p>I started working DevOps which initiated me to learn the about the configuration management and automation tools, Though it does have a learning curve but it provides great oppurtunity to automate most of your tasks. Don&rsquo;t worry it will not make you redundant, learning automation may indeed inflate your profile. Searching on the internet for the same purpose I encountered with <a href="http://garylarizza.com/">Gary Larizza&rsquo;s</a> blog on <a href="http://garylarizza.com/blog/2013/02/01/repeatable-puppet-development-with-vagrant/">Repeatable puppet development with vagrant</a>. Of course the blog being 3 years old, need some rework with the commands, I am hence updating this article as my updated version of his workflow.</p>

<p>In smaller organizations &lsquo;testing&rsquo; and &lsquo;development&rsquo; consist of making changes directly to the server, logging in to the running system and hoping the commands to just work. Once done we document the changes we made, but more OFTEN we happen to keep the information in our head to refer to it later. This is how the manual configuration works. In bigger organization though the things are pretty neat and ready, a centralized configuration management system with everything automated and well documented and code repositories to version control code. This is not a very likely situation while we are writing modules in a development environment and it really doesn&rsquo;t make sense that we put the code in production environment just to test. We need something smaller setup for ourselves, let it be either for the development environment or for my work setup on my personal laptop to automate the things, menial daily jobs, etc etc.. You never know when you find somethings interesting to automate and this can put us in to the good habit of automating things.</p>

<p>And of course I want to keep these things separate from my laptop base configuration, without spending money for buying additional server HW just to test my development work. Vagrant and Virtualbox are boon for the developers who wanted to produce definitive work from anywhere without being dependent on network connection, any need for special physical hardware and a place to code.</p>

<p>We would require ability to create vm&rsquo;s for the purpose of testing our automation workflow, before committing and pushing it to production nodes.</p>

<p><a href="http://www.puppetlabs.com/">Puppet</a> is a configuration management tool which helps autotmates all the aspects of manual configuration. I won&rsquo;t be putting too much puppet in here, however we will be using it to describe the changes we are making to the system.</p>

<p><a href="http://www.vagrantup.com/">Vagrant</a> is a boon for developers and SA for testing their work without making changes to your comfortable laptop work env. It uses minimal VM&rsquo;s template and create virtualized environment on your workstation for the purpose of testing. While writing this Vagrant has support for almost all the major virtualization providers such as Virtualbox, VMware Fusion, Hyper - V, docker.</p>

<h2>Getting Ready for work.</h2>

<p>The only thing which get installed on your system is Vagrant and Virtualbox(if your dones&rsquo;t have one already installed). If you have never used Vagrant before and NOT an ruby developer, it&rsquo;s good to opt of native installaton, its the easiest method to get Vagrant Installed.</p>

<h3>Installing vagrant</h3>

<p><a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a> should provide one pre-packaged binary for your OS.</p>

<p>For ruby developers or those who knows RVM and gem installation</p>

<pre><code>$ gem install vagrant --no-ri --no-rdoc
</code></pre>

<p><strong>Note:</strong> stick with <a href="http://downloads.vagrantup.com/">native installers</a> for now, if you are not much aware about RVM and Rbenv.</p>

<p>We will be installing puppet only of to the VM&rsquo;s and not on our system.</p>

<h3>Living in the box</h3>

<p>Vagrant uses box files as templates from which it creates new virtual machine for development machine. <a href="http://vagrantbox.es/">There are sites that host boxes available for download</a>, OR, you could use to build your box using virtualbox. Building your box file is outside the scope of this article, so just make sure you download a box with an OS that’s to your liking. This box DOES NOT need to have Puppet preinstalled – in fact, it’s probably better that it doesn’t (because the version will probably be old, and we’re going to work around this anyways). I’m going to choose a CentOS 7 box, but, and again, it’s up to you.</p>

<p>I usually create my own <a href="http://www./blog/2016/04/25/create-box-from-vagrant-virtualmachines/">box from the exiting vagrant box</a>, my primary purpose is so that I do not have to download the box and reconfigure it again if I plan to destroy existing vagrant environment.</p>

<p><a href="https://atlas.hashicorp.com/boxes/search">https://atlas.hashicorp.com/boxes/search</a> maintains a list of boxes which are very up to date, you might want to download the latest box, incase you haven&rsquo;t downloaded any.</p>

<h3>Fixing your vagrantfile.</h3>

<p>We need to create a VM for the project and a <code>Vagrantfile</code> to direct vagrant on how it should setup your VM. You can create any directory in your home area which you can use for work with puppet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mkdir -p ~/puppet-vagrant
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/puppet-vagrant
</span></code></pre></td></tr></table></div></figure>


<p>Open Vagrantfile in your favorite editor.</p>

<p>Below is the Sample Vagrantfile which I used to get puppet installed on my box.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;centos/7&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;development.puppetlabs.vm&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;172.31.0.202&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8084</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;centos_7_x.sh&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>the first two config.vm lines establish the box we want to use for our development VM. Because, initially, this box will NOT be known to Vagrant, it will attempt to reach out to that <a href="https://atlas.hashicorp.com/boxes/search">Atlas</a> site and download it. The next three lines define the machine’s hostname, the network type, and the IP address for this VM. In this case, I’m using a private network and giving it an IP address on a made-up 172.31.0.0/24 subnet (feel free to use your own private IP range as long as it doesn’t conflict with anything). The next line is forwarding port 80 on the VM to port 8084 on my local laptop – this allows you to test out web services by simply navigating to <a href="http://localhost:8084">http://localhost:8084</a> from your web browser. I’ll save explaining the last line for the next section.</p>

<p>NOTE: For more documentation on these settings, <a href="http://docs.vagrantup.com/v1/docs/vagrantfile.html">visit Vagrant’s documentation</a> site as it’s quite good. The post I referred to create my dev environment and the post I am writing has many changes may be because of Vagrant version changes. Please refer to the Vagrant docs in case you are reading in near future.</p>

<h3>Installing virtualbox</h3>

<p>Vagrant needs an underlying provider for it to run, the provider is an application which allows your system to run virtual machine. By default vagrant does comes with VirtualBox but in case yours didn&rsquo;t please feel free to download one from <a href="https://www.virtualbox.org/wiki/Downloads">Virtualbox Download</a> site and install it according to your system.</p>

<h3>Installing virtualbox Guest Additions</h3>

<p>While setting up all this, I did got lots of issue with some or the other feature not working, different OSes threw me different errors. But it is always good to have it installed. We may in further be taking about how to share folders with your virtual machine and the host machine. The Virtualbox tools is to be installed on to the Virtual Machine only. So, you may need to do it once box is created. Its an ISO image and can be downloaded from the <a href="http://download.virtualbox.org/">Virtualbox page</a></p>

<p>or you can just do.</p>

<pre><code>vagrant plugin install vagrant-vbguest
</code></pre>

<h3>Getting started with puppet on your VM.</h3>

<p>The final line of the <code>Vagrantfile</code> runs the &lsquo;Shell Provisioner&rsquo; for vagrant. Essentially, this runs a shell script on the VM once its been booted and configured.</p>

<figure class='code'><figcaption><span> (centos_7_x.sh)</span> <a href='/downloads/code/vagrant/centos_7_x.sh'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">set</span> -e
</span><span class='line'>
</span><span class='line'><span class="nv">REPO_URL</span><span class="o">=</span><span class="s2">&quot;http://yum.puppetlabs.com/el/6/products/i386/puppetlabs-release-6-11.noarch.rpm&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span><span class="s2">&quot;$EUID&quot;</span> -ne <span class="s2">&quot;0&quot;</span><span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;This script should be run as root&quot;</span> &gt;<span class="p">&amp;</span>2
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> which puppet &gt; /dev/null 2&gt;<span class="p">&amp;</span>1<span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;Puppet already installed&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>0
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># Install puppet labs repo</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;configuring puppetlabs repo..&quot;</span>
</span><span class='line'><span class="nv">repo_path</span> <span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
</span><span class='line'>wget --output-document<span class="o">=</span><span class="k">${</span><span class="nv">repo_path</span><span class="k">}</span> <span class="k">${</span><span class="nv">REPO_URL</span><span class="k">}</span> 2&gt;/dev/null
</span><span class='line'>rpm -i <span class="k">${</span><span class="nv">repo_path</span><span class="k">}</span> &gt; /dev/null
</span><span class='line'>
</span><span class='line'><span class="c"># Install puppet..</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;installing puppet&quot;</span>
</span><span class='line'>yum install -y puppet &gt; /dev/null
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Puppet installed!!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this script, I setup the puppetlabs el7 repo containing the current package for Puppet/Facter/Hiera/PuppetDB and install the most recent version of puppet and facter present in the repository. This will ensure you get the latest version of puppet, and you don&rsquo;t need to worry about creating a new box everytime, puppet releases a new verion.</p>

<p>This code is from <a href="https://github.com/hashicorp/puppet-bootstrap/blob/master/centos_6_x.sh">Mitchell&rsquo;s puppet bootstrap repo</a>. This code is working for me, but keep checking the repo for any updates. If you maintaining your <strong>own</strong> provisioning script, consider filling a pull request so we can take the benefit from good-code.</p>

<h3>Action time</h3>

<p>Once the <code>Vagrantfile</code> is created the next logical thing is to start the VM and test out vagrant.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>vagrant status
</span><span class='line'>Current machine states:
</span><span class='line'>
</span><span class='line'>default                   not created <span class="o">(</span>virtualbox<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>The environment has not yet been created. Run <span class="sb">`</span>vagrant up<span class="sb">`</span> to
</span><span class='line'>create the environment. If a machine is not created, only the
</span><span class='line'>default provider will be shown. So <span class="k">if</span> a provider is not listed,
</span><span class='line'><span class="k">then</span> the machine is not created <span class="k">for</span> that environment.
</span></code></pre></td></tr></table></div></figure>


<p>Good, so there is no VM created, so lets create one by starting vagrant.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>vagrant up
</span><span class='line'>Bringing machine <span class="s1">&#39;default&#39;</span> up with <span class="s1">&#39;virtualbox&#39;</span> provider...
</span><span class='line'><span class="o">==</span>&gt; default: Importing base box <span class="s1">&#39;centos/7&#39;</span>...
</span><span class='line'><span class="o">==</span>&gt; default: Matching MAC address <span class="k">for</span> NAT networking...
</span><span class='line'><span class="o">==</span>&gt; default: Checking <span class="k">if</span> box <span class="s1">&#39;centos/7&#39;</span> is up to date...
</span><span class='line'><span class="o">==</span>&gt; default: Setting the name of the VM: <span class="nv">octopressnotes_default_1461604478526_97058</span>
</span><span class='line'><span class="o">==</span>&gt; default: Clearing any previously <span class="nb">set </span>network interfaces...
</span><span class='line'><span class="o">==</span>&gt; default: Preparing network interfaces based on configuration...
</span><span class='line'>    default: Adapter 1: nat
</span><span class='line'>    default: Adapter 2: <span class="nv">hostonly</span>
</span><span class='line'><span class="o">==</span>&gt; default: Forwarding ports...
</span><span class='line'>    default: <span class="m">80</span> <span class="o">(</span>guest<span class="o">)</span> <span class="o">=</span>&gt; <span class="m">8084</span> <span class="o">(</span>host<span class="o">)</span> <span class="o">(</span>adapter 1<span class="o">)</span>
</span><span class='line'>    default: <span class="m">22</span> <span class="o">(</span>guest<span class="o">)</span> <span class="o">=</span>&gt; <span class="m">2222</span> <span class="o">(</span>host<span class="o">)</span> <span class="o">(</span>adapter 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span>&gt; default: Booting VM...
</span><span class='line'><span class="o">==</span>&gt; default: Waiting <span class="k">for</span> machine to boot. This may take a few minutes...
</span><span class='line'><span class="o">==</span>&gt; default: Machine booted and ready!
</span><span class='line'><span class="o">==</span>&gt; default: Checking <span class="k">for</span> guest additions in VM...
</span><span class='line'><span class="o">==</span>&gt; default: Setting hostname...
</span><span class='line'><span class="o">==</span>&gt; default: Configuring and enabling network interfaces...
</span><span class='line'><span class="o">==</span>&gt; default: Mounting shared folders...
</span><span class='line'><span class="o">==</span>&gt; default: Machine already provisioned. Run <span class="sb">`</span>vagrant provision<span class="sb">`</span> or use the <span class="sb">`</span>--provision<span class="sb">`</span>
</span><span class='line'><span class="o">==</span>&gt; default: flag to force provisioning. Provisioners marked to run always will still run.
</span></code></pre></td></tr></table></div></figure>


<p>Vagrant first noticed and checked for the centos/7 box locally, since I already have the box added into my Vagrant it didn&rsquo;t redownload it but used the same box to create a custom VM, if the machine is not present locally, Vagrant will download the box from hashicorp site. Next Vagrant moves to configuring the hostname and the network as per our Vagrantfile, and Lastly it runs the script it for provisioning the VM.</p>

<p>We have got the VM with puppet installed. Let&rsquo;s login to the VM and check the puppet version.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>vagrant ssh
</span><span class='line'>
</span><span class='line'>Last login: Wed Apr <span class="m">13</span> 13:11:28 <span class="m">2016</span> from 10.0.2.2
</span><span class='line'><span class="o">[</span>vagrant@development ~<span class="o">]</span><span class="nv">$ </span>puppet --version
</span><span class='line'>3.8.6
</span><span class='line'><span class="o">[</span>vagrant@development ~<span class="o">]</span><span class="nv">$ </span>hostname
</span><span class='line'>development.puppetlabs.vm
</span><span class='line'><span class="o">[</span>vagrant@development ~<span class="o">]</span><span class="nv">$ </span><span class="nb">exit</span>
</span><span class='line'><span class="nb">logout</span>
</span><span class='line'>Connection to 127.0.0.1 closed.
</span></code></pre></td></tr></table></div></figure>


<p>So now we know how to SSH into the VM, check the Puppet version, check the hostname to check we are on the correct host. Now we go ahead and confiure puppet to do something with this machine.</p>

<h3>Working with puppet</h3>

<p>Now we have got a clean VM, and were able to set up as well, the purpose of this doc was to set up a puppet development environment using vagrant. For writing puppet modules, <a href="http://www.amazon.com/Puppet-Cookbook-Third-Thomas-Uphill/dp/1784394882/ref=sr_1_1?ie=UTF8&amp;qid=1461809235&amp;sr=8-1&amp;keywords=puppet+cookbook">puppet cookbook</a> is a good beginning point.</p>

<p>More on putting things in order and avoid messing up.</p>

<p>I Locally use git to be for version controlling and source code management, with time to time push to remote. Use Github for storing repositories remotely.</p>

<p>My final Vagrantfile contains as below.</p>

<figure class='code'><figcaption><span>Vagrantfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;dev-env&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;development.puppetlabs.vm&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;172.31.0.202&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8084</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;centos_7_x.sh&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Puppet shared folder</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;puppet&quot;</span><span class="p">,</span> <span class="s2">&quot;/puppet&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#puppet provision setup</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:puppet</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppet</span><span class="o">|</span>
</span><span class='line'>    <span class="n">puppet</span><span class="o">.</span><span class="n">manifests_path</span> <span class="o">=</span> <span class="s2">&quot;puppet/manifests&quot;</span>
</span><span class='line'>    <span class="n">puppet</span><span class="o">.</span><span class="n">module_path</span> <span class="o">=</span> <span class="s2">&quot;puppet/modules&quot;</span>
</span><span class='line'>    <span class="n">puppet</span><span class="o">.</span><span class="n">manifest_file</span> <span class="o">=</span> <span class="s2">&quot;site.pp&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I ensured to share my local dir with my vagrant machine, so that my download modules can be directly available to the vagrant machine for work.</p>
</div>


  <footer>
    <p class="meta">
      
  



  <span class="byline author vcard">Authored by <span class="fn">
  
    Om Prakash Singh
  
  </span></span>


      




<time class='entry-date' datetime='2016-04-24T16:40:46+05:30'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:40 pm</span></time>
      
      

<span class="categories">
  
    <a class='category' href='/blog/categories/puppet/'>puppet</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.omps.in/blog/2016/04/24/puppet-development-environment/" data-via="ohgnis" data-counturl="http://www.omps.in/blog/2016/04/24/puppet-development-environment/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/04/24/howto-tweet-new-posts-in-octopress/" title="Previous Post: Tweet Posts with Octopress">&laquo; Tweet Posts with Octopress</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/04/25/create-box-from-vagrant-virtualmachines/" title="Next Post: Create box from vagrant virtualmachines">Create box from vagrant virtualmachines &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Om Prakash Singh -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
